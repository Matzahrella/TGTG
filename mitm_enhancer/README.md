# Mitmproxy Enhancement Tool

This tool helps parse, annotate, and document HTTP/HTTPS traffic captured by Mitmproxy to aid in API reverse engineering. It allows for interactive viewing, searching, and annotation of flows, and can export the processed data to a Markdown file.

## Features

*   **Load Mitmproxy Flow Files**: Parses and loads HTTP/HTTPS flows from files generated by Mitmproxy.
*   **Interactive CLI**: Provides a command-line interface for easy navigation and interaction with flows:
    *   Navigate sequentially (`next`, `previous`).
    *   Jump directly to a flow by its index (`jump`).
*   **Flow Annotation**: Add or update custom notes and observations to individual flows.
*   **Search Functionality**: Search through flows based on terms found in:
    *   URLs
    *   Annotations
    *   Request and Response bodies (including JSON content).
*   **Pretty-Printing**: Automatically pretty-prints JSON request and response bodies for better readability.
*   **Markdown Export**: Export all flow data, including your annotations, to a well-formatted Markdown file for documentation and analysis.

## Installation

1.  **Prerequisites**: Ensure you have Python 3.7+ installed.
2.  **Clone the Repository** (if you haven't already):
    ```bash
    # git clone <repository_url> # Replace <repository_url> if applicable
    # cd <repository_directory>
    ```
3.  **Install Dependencies**:
    The main dependency is `mitmproxy`. Dependencies are listed in `mitm_enhancer/requirements.txt`. Install them using pip:
    ```bash
    pip install -r mitm_enhancer/requirements.txt
    ```

## Usage

To run the tool, execute the `main.py` script as a module from the root directory of the project, providing the path to your mitmproxy flow file:

```bash
python -m mitm_enhancer.main <path_to_your_flow_file.mitm>
```

For example:
```bash
python -m mitm_enhancer.main captured_traffic/flows.mitm
```

### Interactive CLI Commands

Once the tool is running and flows are loaded, you can use the following commands in the interactive prompt:

*   `(n)ext`: Go to the next flow.
*   `(p)revious`: Go to the previous flow.
*   `(a)nnotate <text>`: Add or update the annotation for the current flow.
    *   Example: `a User registration process`
*   `(j)ump <index>`: Jump to a specific flow by its 0-based index.
    *   Example: `j 5`
*   `(s)earch <term>`: Search all flows for the specified term. The search is case-insensitive and covers URLs, annotations, and request/response bodies.
    *   Example: `s login_token`
*   `(e)xport <filename.md>`: Export all current flows (including annotations) to the specified Markdown file.
    *   Example: `e analysis_export.md`
*   `(q)uit`: Exit the program.

## Example Markdown Export Snippet

Here's a brief example of what a single flow might look like in the exported Markdown file:

```markdown
## Flow ID: `a1b2c3d4-e5f6-7890-1234-567890abcdef`
**Annotation:** Successful user authentication
**Timestamp Created:** 1678886400.123456
**Client Connection ID:** client_conn_uuid_1
**Server Connection ID:** server_conn_uuid_1

### Request
**Timestamp:** 1678886400.200000
**Method:** `POST`
**URL:** `https://api.example.com/auth/login`
**Headers:**
```
Host: api.example.com
Content-Type: application/json
User-Agent: MyApp/1.0
Accept: application/json
```
**Body (`application/json`):**
```json
{
  "username": "testuser",
  "password": "securepassword123"
}
```
---
### Response
**Timestamp:** 1678886400.800000
**Status Code:** `200`
**Headers:**
```
Content-Type: application/json
Server: ExampleAPI/v2
Date: Mon, 25 Mar 2024 10:00:00 GMT
```
**Body (`application/json`):**
```json
{
  "status": "success",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user_id": "user_xyz789"
}
```
---
<br/>
<hr/>
<br/>
```

This structured output helps in reviewing and documenting API interactions.
